<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Casino Pempin</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg: #0f172a;
  --card: #1e293b;
  --accent: #38bdf8;
  --text: #f8fafc;
  --muted: #94a3b8;
  font-family: 'Inter', system-ui, sans-serif;
}
body {
  background: var(--bg);
  color: var(--text);
  padding: 16px;
  margin: 0;
  max-width: 900px;
  margin-inline: auto;
}
h1 { text-align: center; color: var(--accent); margin-top: 0.5rem; }
.card {
  background: var(--card);
  padding: 16px;
  border-radius: 16px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.2);
  margin-bottom: 20px;
}
input, select {
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: none;
  background: #334155;
  color: white;
  margin-top: 4px;
  font-size: 1rem;
}
button {
  border: none;
  border-radius: 12px;
  padding: 8px 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
button.primary { background: var(--accent); color: black; }
button.primary:hover { background: #67e8f9; }
button.secondary {
  background: transparent; border: 1px solid var(--muted); color: var(--muted);
}
button.secondary:hover { border-color: var(--accent); color: var(--accent); }
button.danger { background: #ef4444; color: white; }
button.import { background: #16a34a; color: white; }
button.import:hover { background: #22c55e; }

.player-row {
  background: #1e293b;
  border-radius: 12px;
  padding: 12px;
  margin-top: 10px;
}
.player-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 6px;
}
.bet-display {
  font-size: 1.1rem;
  color: var(--accent);
  font-weight: bold;
}
.bet-buttons {
  display: flex;
  gap: 6px;
  flex-wrap: wrap;
  margin-top: 8px;
}
.chip {
  border-radius: 50%;
  width: 46px;
  height: 46px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-weight: bold;
  cursor: pointer;
  border: 2px solid white;
  color: white;
  transition: transform 0.1s, box-shadow 0.1s;
}
.chip:hover { transform: scale(1.1); box-shadow: 0 0 10px rgba(255,255,255,0.4); }

/* Farby ≈æet√≥nov */
.chip[data-val="0.05"] { background: #a855f7; }
.chip[data-val="0.1"]  { background: #16a34a; }
.chip[data-val="0.2"]  { background: #f97316; }
.chip[data-val="0.5"]  { background: #ef4444; }
.chip[data-val="1"]    { background: #3b82f6; }

hr { border: none; height: 1px; background: #334155; margin: 14px 0; }
.summary { display: flex; flex-wrap: wrap; gap: 8px; }
.pill { background: #334155; border-radius: 10px; padding: 6px 12px; font-size: 0.9rem; }
.entry { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #334155; }
small { color: var(--muted); }
canvas { width: 100%; max-height: 300px; }
.split-options { display: none; gap: 4px; }
.split-options.active { display: flex; flex-direction: column; }

/* Split prep√≠naƒç */
.split-toggle {
  position: relative;
  display: inline-block;
  width: 48px;
  height: 26px;
}
.split-toggle input { opacity: 0; width: 0; height: 0; }
.slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background-color: #475569;
  transition: .3s;
  border-radius: 34px;
}
.slider:before {
  position: absolute;
  content: "üé¥";
  height: 22px;
  width: 22px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
  transition: .3s;
}
.split-toggle input:checked + .slider {
  background-color: var(--accent);
  box-shadow: 0 0 10px var(--accent);
}
.split-toggle input:checked + .slider:before {
  transform: translateX(22px);
}
</style>
</head>
<body>
<h1>üé∞ Casino Pempin</h1>

<section class="card">
  <h2>Nov√© kolo</h2>
  <div id="players"></div>
  <button class="secondary" id="addPlayer">‚ûï Prida≈• hr√°ƒça</button>
  <hr>
  <button class="primary" id="saveRound">üíæ Ulo≈æi≈• kolo</button>
</section>

<section class="card">
  <h2>Hist√≥ria</h2>
  <div id="history"></div>
  <hr>
  <div class="summary" id="summary"></div>
  <hr>
  <button class="secondary" id="exportCSV">‚òÅÔ∏è Exportova≈• CSV</button>
  <button class="danger" id="clearAll">Vymaza≈• v≈°etko</button>
  <button class="import" id="importCSV">üì• Importova≈• CSV</button>
  <input type="file" id="importFile" accept=".csv" style="display:none;">
</section>

<section class="card">
  <h2>üìä Graf ziskov</h2>
  <canvas id="chart"></canvas>
</section>

<script>
const KEY = "blackjack_rounds_v4";
let chart = null;
let savedPlayers = [];
let lastBets = {};

// --- Load / Save ---
function loadData() {
  try { return JSON.parse(localStorage.getItem(KEY)) || []; }
  catch { return []; }
}
function saveData(data) {
  localStorage.setItem(KEY, JSON.stringify(data));
  render();
}
function uid() { return Date.now().toString(36) + Math.random().toString(36).slice(2,6); }

// --- Add Player UI ---
function addPlayerRow(name="", bet=0, result="win") {
  const div = document.createElement("div");
  div.className = "player-row";
  div.innerHTML = `
    <div class="player-header">
      <input type="text" placeholder="Meno hr√°ƒça" value="${name}">
      <select class="main-result">
        <option value="win" ${result=="win"?"selected":""}>Vyhral</option>
        <option value="lose" ${result=="lose"?"selected":""}>Prehral</option>
        <option value="push" ${result=="push"?"selected":""}>Rem√≠za</option>
      </select>
      <label class="split-toggle">
        <input type="checkbox" class="split-check">
        <span class="slider"></span>
      </label>
      <button class="secondary remove">‚ùå</button>
    </div>
    <div class="split-options">
      <select class="split1">
        <option value="win">Split 1: Vyhral</option>
        <option value="lose">Split 1: Prehral</option>
        <option value="push">Split 1: Rem√≠za</option>
      </select>
      <select class="split2">
        <option value="win">Split 2: Vyhral</option>
        <option value="lose">Split 2: Prehral</option>
        <option value="push">Split 2: Rem√≠za</option>
      </select>
    </div>
    <div style="margin-top:6px;">
      <div class="bet-display">St√°vka: <span class="bet-val">${bet.toFixed(2)}</span> ‚Ç¨</div>
      <div class="bet-buttons">
        ${[0.05,0.1,0.2,0.5,1].map(v=>`<div class="chip" data-val="${v}">${v}</div>`).join("")}
        <button class="secondary reset-bet">‚ôªÔ∏è Nulova≈•</button>
        <button class="secondary repeat-bet">üîÅ Zopakova≈•</button>
      </div>
    </div>
  `;
  const betValEl = div.querySelector(".bet-val");
  let currentBet = bet;
  div.querySelectorAll(".chip").forEach(chip=>{
    chip.onclick=()=>{
      currentBet += parseFloat(chip.dataset.val);
      betValEl.textContent = currentBet.toFixed(2);
    };
  });
  div.querySelector(".reset-bet").onclick = ()=>{
    currentBet = 0;
    betValEl.textContent = "0.00";
  };
  div.querySelector(".repeat-bet").onclick = ()=>{
    const playerName = div.querySelector("input[type=text]").value.trim();
    if(!playerName || !lastBets[playerName]) return alert("Nie je dostupn√° predch√°dzaj√∫ca st√°vka pre tohto hr√°ƒça!");
    currentBet = lastBets[playerName];
    betValEl.textContent = currentBet.toFixed(2);
  };
  div.querySelector(".remove").onclick = ()=>div.remove();
  const splitCheck = div.querySelector(".split-check");
  const splitOptions = div.querySelector(".split-options");
  splitCheck.onchange = ()=>splitOptions.classList.toggle("active", splitCheck.checked);
  div.getBet = ()=>currentBet;
  div.isSplit = ()=>splitCheck.checked;
  div.getResults = ()=>splitCheck.checked
    ? [div.querySelector(".split1").value, div.querySelector(".split2").value]
    : [div.querySelector(".main-result").value];
  document.getElementById("players").appendChild(div);
}

// --- Calculate Results ---
function calculateResults(players) {
  const results = [];
  players.forEach(p=>{
    const bet = Number(p.bet) || 0;
    const dealerTotal = { total: 0 };
    p.results.forEach((res,i)=>{
      let actualBet = bet;
      if(p.results.length>1) actualBet = bet; // split st√°vka
      let playerNet = res==="win"?actualBet:res==="lose"?-actualBet:0;
      dealerTotal.total -= playerNet;
      results.push({
        id: uid(), date: new Date().toLocaleString(),
        player: p.results.length>1?`${p.name} (${i+1})`:p.name||"Nezn√°my",
        bet: actualBet, result: res,
        playerNet, dealerNet: -playerNet
      });
    });
    results.push({
      id: uid(), date: new Date().toLocaleString(),
      player:"DEALER", bet:"-", result:"‚Äî",
      playerNet: dealerTotal.total, dealerNet:0
    });
  });
  return results;
}

// --- Render ---
function render(){
  const data=loadData();
  const histEl=document.getElementById("history");
  const sumEl=document.getElementById("summary");
  histEl.innerHTML=""; sumEl.innerHTML="";
  if(data.length===0){ histEl.innerHTML="<small>≈Ωiadne z√°znamy.</small>"; if(chart) chart.destroy(); return; }
  data.slice().reverse().forEach(e=>{
    const el=document.createElement("div"); el.className="entry";
    el.innerHTML=`<div><strong>${e.player}</strong><br><small>${e.date}</small></div>
    <div style="text-align:right"><div><small>St√°vka:</small> ${e.bet}</div>
    <div><small>Zisk:</small> ${e.playerNet}</div></div>`;
    histEl.appendChild(el);
  });
  const totals={}, rounds={};
  data.forEach(e=>{
    if(e.player==="DEALER") return;
    const name = e.player.replace(/\s*\(\d+\)$/, "");
    if(!totals[name]){ totals[name]=0; rounds[name]=0; }
    totals[name]+=Number(e.playerNet);
    rounds[name]++;
  });
  Object.entries(totals).forEach(([n,v])=>{
    const el=document.createElement("div"); el.className="pill";
    el.innerHTML=`<strong>${n}:</strong> ${v.toFixed(2)} ‚Ç¨ <br><small>K√¥l: ${rounds[n]}</small>`;
    sumEl.appendChild(el);
  });
  renderChart(totals);
}
function renderChart(totals){
  const ctx=document.getElementById("chart");
  const names=Object.keys(totals).filter(n=>n!=="DEALER");
  const vals=names.map(n=>totals[n]);
  if(chart)chart.destroy();
  chart=new Chart(ctx,{
    type:"bar",
    data:{ labels:names, datasets:[{label:"Zisk hr√°ƒça (‚Ç¨)", data:vals, backgroundColor:"#38bdf8", borderRadius:8}]},
    options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}
  });
}

// --- Export / Import CSV ---
document.getElementById("exportCSV").onclick=()=>{
  const data=loadData(); if(!data.length)return alert("≈Ωiadne d√°ta na export!");
  const header=["date","player","bet","result","playerNet","dealerNet"];
  const rows=data.map(r=>header.map(h=>JSON.stringify(r[h]??"")).join(","));
  const csv=[header.join(","),...rows].join("\n");
  const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"}); const url=URL.createObjectURL(blob);
  const a=document.createElement("a"); a.href=url; a.download="blackjack_data.csv"; a.click(); URL.revokeObjectURL(url);
};
document.getElementById("importCSV").onclick=()=>document.getElementById("importFile").click();
document.getElementById("importFile").addEventListener("change", e=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=ev=>{
    try{
      const lines=ev.target.result.split("\n").filter(l=>l.trim().length>1);
      const header=lines.shift().split(",").map(h=>h.replace(/"/g,"").trim());
      const rows=lines.map(l=>{
        const vals=l.split(",").map(v=>v.replace(/^"|"$/g,""));
        const obj={};
        header.forEach((h,i)=>obj[h]=["bet","playerNet","dealerNet"].includes(h)?Number(vals[i]):vals[i]);
        return obj;
      });
      const existing=loadData();
      saveData([...existing,...rows]);
      alert(`‚úÖ Importovan√Ωch ${rows.length} z√°znamov!`);
      e.target.value="";
    }catch(err){ console.error(err); alert("‚ùå Chyba pri importe CSV."); }
  };
  reader.readAsText(file);
});

// --- Other actions ---
addPlayerRow();
document.getElementById("addPlayer").onclick=()=>addPlayerRow();
document.getElementById("saveRound").onclick=()=>{
  const rows=document.querySelectorAll("#players .player-row");
  if(!rows.length)return alert("Pridaj aspo≈à jedn√©ho hr√°ƒça!");
  const players=Array.from(rows).map(r=>({name:r.querySelector("input[type=text]").value.trim(),bet:r.getBet(),results:r.getResults()}));
  players.forEach(p=>{if(p.name)lastBets[p.name]=p.bet;});
  savedPlayers=players.map(p=>p.name).filter(n=>n!=="");
  const all=loadData(); const newEntries=calculateResults(players); saveData([...all,...newEntries]);
  document.getElementById("players").innerHTML=""; savedPlayers.forEach(n=>addPlayerRow(n,0,"win"));
  alert("Kolo ulo≈æen√© ‚úÖ ‚Äì nov√© kolo pripraven√©!");
};
document.getElementById("clearAll").onclick=()=>{
  if(confirm("Naozaj chce≈° zmaza≈• v≈°etky z√°znamy?")){localStorage.removeItem(KEY); render();}
};
render();
</script>
</body>
</html>
